<head>
  <style>
    body { margin: 0; }
    #info-panel {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw; /* Full width */
  height: 100vh; /* Full height */
  background-color: rgba(255, 255, 255, 0.95); /* Slight transparency for better readability */
  display: none;
  text-align: center;
  padding: 20px;
  box-shadow: none; /* Remove unnecessary shadow */
  overflow-y: auto; /* Scroll if content overflows */
  font-size: 1.5rem; /* Increase readability */
  z-index: 1000;
}

#info-panel h3 {
  font-size: 2rem; /* Make headings larger */
}

#info-panel p {
  font-size: 1.5rem; /* Increase text size */
}

#info-panel button {
  font-size: 1.5rem;
  padding: 15px 25px;
  margin-top: 20px;
  border: none;
  background-color: black;
  color: white;
  border-radius: 10px;
  cursor: pointer;
  width: 90%;
  max-width: 300px;
}

#info-panel button:hover {
  background-color: #444;
}

@media (min-width: 600px) {
  #info-panel {
    width: 80vw; /* Make it smaller on desktop */
    height: auto;
    max-width: 500px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 30px;
    border-radius: 15px;
    background-color: white;
    box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
  }
}

</style>

<script src="//unpkg.com/3d-force-graph"></script>
<script src="https://unpkg.com/neo4j-driver"></script>
</head>

<body>
  <div id="3d-graph"></div>
  <div id="info-panel"></div>

  <script>
    const driver = neo4j.driver("neo4j+s://7714be1a.databases.neo4j.io", neo4j.auth.basic("neo4j", "lwW-hWpruNTNNrD-gCAMreXMZcUlAFcrjxmaeL94ZzM"));
    const session = driver.session({ database: "neo4j" });
    const start = new Date();

    session
    .run(
      'MATCH (u:User)-[r:CONNECTED_TO]->(v:User) RETURN u.name AS source, u.role AS sourceRole, u.title AS sourceTitle, u.website AS sourceWebsite, v.name AS target, v.role AS role, v.title AS title, v.website AS website LIMIT $limit', 
      { limit: neo4j.int(5000) }
      )
    .then(function (result) {
      const links = result.records.map(r => ({ 
        source: r.get('source'), 
        target: r.get('target')  
      }));

      const nodesMap = new Map();

      result.records.forEach(r => {
        const addNode = (id, role, title, website) => {
          if (!nodesMap.has(id)) {
            nodesMap.set(id, { id, name: id, role, title, website });
          }
        };

        addNode(r.get('source'), r.get('sourceRole'), r.get('sourceTitle'), r.get('sourceWebsite'));
        addNode(r.get('target'), r.get('role'), r.get('title'), r.get('website'));
      });

      const nodes = Array.from(nodesMap.values());

      const gData = { nodes, links };

      const Graph = ForceGraph3D()(document.getElementById('3d-graph'))
      .graphData(gData)
      .nodeLabel(node => node.role || 'N/A')
      .onNodeHover(node => {
        Graph.nodeLabel(node ? (n => n.title || n.role || 'N/A') : (n => n.role || 'N/A'));
      })
      .onNodeClick(node => {
        const infoPanel = document.getElementById('info-panel');
        infoPanel.innerHTML = `
              <h3>Network Info</h3>
              <p><strong>Name:</strong> ${node.name}</p>
              <p><strong>Title:</strong> ${node.title || 'N/A'}</p>
              <p><strong>Role:</strong> ${node.role || 'N/A'}</p>
          <p><strong>Website:</strong> ${node.website && node.website !== '' ? `<a href="${node.website}" target="_blank" rel="noopener noreferrer">${node.website.length > 30 ? `${node.website.substring(0, 30)}...` : node.website}</a>` : ''}</p>
              <button onclick="document.getElementById('info-panel').style.display='none'">Close</button>
        `;
        infoPanel.style.display = 'block';
      });

      session.close();
    })
    .catch(error => console.error("Error running query:", error));
  </script>
</body>